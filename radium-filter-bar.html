<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="radium-filter-behavior.html">
<!--
Header bar Polymer element for doing filters / faceted search.

@element radium-filter-bar
@demo demo/index.html Basic demo
-->
<dom-module id="radium-filter-bar">
  <style is="custom-style">
    .filterbar {
      background-color: #DDDDDD;
      color: rgba(0, 0, 0, 0.87);
      line-height: 40px;
      padding: 0px 24px;
    }
    .filterbar-title {
      margin: 0px 16px 0px 0px;
    }
    .filterbar paper-button {
      margin: 0px 8px 0px 0px;
      min-width: initial;
      text-transform: none;
      white-space: nowrap;
    }
    .filterbar a {
      text-align:right;
      cursor: pointer;
    }
    .filterbar paper-button {
      padding: 0px;
    }
    .filterbar paper-button > ::content paper-material {
      padding: 0px;
    }
    .filterbar iron-icon {
      color: #ff0000;
      width: 14px;
      height: 14px;
      margin: 2px 0px 0px 0px;
    }
    .typo-body2 {
      font-size: 14px !important;
      font-weight: 500 !important;
    }
    .typo-body1 {
      font-size: 14px !important;
      font-weight: 400 !important;
    }
  </style>
  <template>
    <div class="filterbar horizontal layout">
      <div class="filterbar-title typo-body2">Filtered By:</div>
      <div class="flex">
        <template is="dom-repeat" items="[[_terms]]">
          <paper-button on-click="_termClicked" data-term$="[[item]]">
            <span class="typo-body1">[[item.label]]</span>
            <iron-icon icon="close"></iron-icon>
          </paper-button>
        </template>
      </div>
      <a on-click="_clear">
        <span class="typo-body1">Clear All</span>
      </a>
    </div>
  </template>
</dom-module>
<script>
  (function() {
    Polymer({
      is: 'radium-filter-bar',
      properties: {
        filters: {
          type: Array,
          value: function() { return []; },
          observer: '_filtersChanged'
        },
        _terms: {
          type: Array,
          value: function() { return []; }
        },
        _previousPath: {
          type: String,
          value: ''
        }
      },
      behaviors: [RadiumFilterBehavior],
      _filtersChanged: function() {
        this.async(function(){this._evaluateQueryString();}.bind(this));
      },
      _evaluateQueryString: function() {
        var newPath = window.location.pathname + window.location.hash.split('?')[0];
        if (this._previousPath === '' || newPath === this._previousPath) {
          this.setFilterTerms();
        }
        this._previousPath = newPath;
      },
      _termClicked: function(evt) {
        var fltr = JSON.parse(evt.currentTarget.getAttribute('data-term'));
        var filterTerm = fltr.key + ':' + encodeURIComponent(fltr.value);
        this.removeFilter(filterTerm);
      },
      _clear: function() {
        this.removeAllFilters();
      },
      ready: function() {
        window.addEventListener('hashchange', this._evaluateQueryString.bind(this));
        this._evaluateQueryString();
      },
    });
  })();
</script>

